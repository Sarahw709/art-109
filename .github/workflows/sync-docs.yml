name: Sync Portfolio to Docs

on:
  push:
    branches:
      - main
    paths:
      - 'Tutorials/03-css-single-page-portfolio/**'
      - 'Tutorials/04-css-transitions/**'
      - 'Tutorials/05-css-portfolio-grid/**'
      - 'Tutorials/06-dom/**'
      - '.github/workflows/sync-docs.yml'

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Sync files to docs folder
        run: |
          # Sync 03 portfolio (root of site)
          rm -rf docs/css docs/images
          rm -f docs/index.html
          cp -r Tutorials/03-css-single-page-portfolio/* docs/
          touch docs/.nojekyll
          # Sync 04-css-transitions (subfolder)
          rm -rf docs/04-css-transitions
          cp -r Tutorials/04-css-transitions docs/
          # Sync 05-css-portfolio-grid (subfolder)
          rm -rf docs/05-css-portfolio-grid
          cp -r Tutorials/05-css-portfolio-grid docs/
          mkdir -p docs/05-css-portfolio-grid/images
          cp docs/images/*.jpg docs/05-css-portfolio-grid/images/ 2>/dev/null || true
          # Sync 06-dom (subfolder)
          rm -rf docs/06-dom
          cp -r Tutorials/06-dom docs/

      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add docs/
          if ! git diff --staged --quiet; then
            git commit -m "Auto-sync portfolio files to docs folder [skip ci]"
            git push
          else
            echo "No changes to commit"
          fi
